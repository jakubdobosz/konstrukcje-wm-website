---
import Header from './Header.astro';
import Footer from './Footer.astro';
import CTA from './CTA.astro';
import { projects } from '../i18n/projects';
import type { ServiceData } from '../i18n/services';

interface Props {
  lang: string;
  service: ServiceData;
}

const { lang, service } = Astro.props;
const base = import.meta.env.BASE_URL;
const data = service.data[lang];

const labels = {
  pl: { back: '← Wszystkie usługi', clients: 'Dla kogo', scope: 'Zakres prac', process: 'Jak pracujemy', related: 'Powiązane realizacje' },
  en: { back: '← All services', clients: 'Who we work with', scope: 'Scope of work', process: 'How we work', related: 'Related projects' },
  de: { back: '← Alle Leistungen', clients: 'Für wen', scope: 'Leistungsumfang', process: 'Wie wir arbeiten', related: 'Verwandte Projekte' },
};
const lb = labels[lang] || labels.pl;

const backLink = lang === 'pl' ? `${base}` : lang === 'en' ? `${base}en/` : `${base}de/`;
const contactLink = lang === 'pl' ? `${base}kontakt` : lang === 'en' ? `${base}en/contact` : `${base}de/kontakt`;
const ctaLabel = lang === 'pl' ? 'Bezpłatna analiza projektu →' : lang === 'en' ? 'Free project analysis →' : 'Kostenlose Projektanalyse →';

const relatedProjects = data.relatedProjects
  .map(slug => projects.find(p => p.slug === slug))
  .filter(Boolean);
---

<Header lang={lang} />

<section class="service-hero">
  <div class="container">
    <a href={backLink} class="back-link">{lb.back}</a>
    <span class="service-icon-big">{service.icon}</span>
    <h1>{data.title}</h1>
    <p class="hero-desc">{data.hero}</p>
    <a href={contactLink} class="btn-primary">{ctaLabel}</a>
  </div>
</section>

<section class="section">
  <div class="container desc-wrap">
    <p class="description">{data.description}</p>
  </div>
</section>

<section class="section clients-section">
  <div class="container">
    <div class="section-header-center">
      <div class="section-label">{lb.clients}</div>
    </div>
    <div class="grid-3">
      {data.clients.map(client => (
        <div class="client-card observe">
          <h3>{client.title}</h3>
          <p>{client.desc}</p>
        </div>
      ))}
    </div>
  </div>
</section>

<section class="section scope-section">
  <div class="container">
    <div class="section-header-center">
      <div class="section-label">{lb.scope}</div>
    </div>
    <div class="scope-list">
      {data.scope.map(item => (
        <div class="scope-item observe">
          <span class="scope-check">✓</span>
          <span>{item}</span>
        </div>
      ))}
    </div>
  </div>
</section>

<section class="section process-section">
  <div class="container">
    <div class="section-header-center">
      <div class="section-label">{lb.process}</div>
    </div>
    <div class="process-grid">
      {data.process.map((step, i) => (
        <div class="process-step observe">
          <div class="step-number">{String(i + 1).padStart(2, '0')}</div>
          <h3>{step.step}</h3>
          <p>{step.desc}</p>
        </div>
      ))}
    </div>
  </div>
</section>

{relatedProjects.length > 0 && (
  <section class="section related-section">
    <div class="container">
      <div class="section-header-center">
        <div class="section-label">{lb.related}</div>
      </div>
      <div class="grid-2">
        {relatedProjects.map(project => {
          if (!project) return null;
          const pData = project.data[lang];
          const projectPath = lang === 'pl' ? `realizacje/${project.slug}` : lang === 'en' ? `en/projects/${project.slug}` : `de/projekte/${project.slug}`;
          return (
            <a href={`${base}${projectPath}`} class="related-card observe">
              <img src={`${base}images/projects/${project.images[0]}`} alt={pData.name} loading="lazy" />
              <div class="related-info">
                <h4>{pData.name}</h4>
                <span>{project.flag} {project.country} · {pData.type}</span>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>
)}

<CTA lang={lang} />
<Footer lang={lang} />

<style>
  .service-hero{padding:140px 0 var(--space-3xl);background:var(--dark-card);border-bottom:1px solid var(--dark-border)}
  .back-link{display:inline-block;color:var(--text-muted);font-size:.85rem;margin-bottom:var(--space-xl);text-decoration:none;transition:color .2s}
  .back-link:hover{color:var(--gold)}
  .service-icon-big{font-size:3rem;display:block;margin-bottom:var(--space-md)}
  .service-hero h1{font-family:var(--font-heading);margin-bottom:var(--space-md)}
  .hero-desc{color:var(--text-secondary);font-size:1.15rem;max-width:700px;margin-bottom:var(--space-xl);line-height:1.7}
  .desc-wrap{max-width:800px;margin:0 auto}
  .description{font-size:1.1rem;color:var(--text-secondary);line-height:1.8;text-align:center}
  .clients-section{background:var(--dark-card)}
  .client-card{background:var(--dark);border:1px solid var(--dark-border);border-radius:12px;padding:var(--space-xl);transition:.3s}
  .client-card:hover{border-color:rgba(201,169,110,.2)}
  .client-card h3{font-family:var(--font-heading);font-size:1.05rem;margin-bottom:var(--space-sm);color:var(--gold)}
  .client-card p{color:var(--text-secondary);font-size:.9rem;line-height:1.7}
  .scope-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--space-md);max-width:900px;margin:0 auto}
  .scope-item{display:flex;align-items:center;gap:var(--space-md);padding:var(--space-md) var(--space-lg);background:var(--dark-card);border:1px solid var(--dark-border);border-radius:10px;color:var(--text-secondary);font-size:.9rem}
  .scope-check{color:var(--gold);font-weight:bold;font-size:1.1rem;flex-shrink:0}
  .process-section{background:var(--dark-card)}
  .process-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--space-lg)}
  .process-step{text-align:center;padding:var(--space-xl)}
  .step-number{width:48px;height:48px;border-radius:50%;background:rgba(201,169,110,.1);border:1px solid rgba(201,169,110,.2);color:var(--gold);font-family:var(--font-heading);font-weight:700;font-size:1.25rem;display:flex;align-items:center;justify-content:center;margin:0 auto var(--space-md)}
  .process-step h3{font-family:var(--font-heading);font-size:1rem;margin-bottom:var(--space-sm)}
  .process-step p{color:var(--text-secondary);font-size:.85rem;line-height:1.6}
  .related-card{display:flex;align-items:center;gap:var(--space-lg);background:var(--dark-card);border:1px solid var(--dark-border);border-radius:12px;overflow:hidden;text-decoration:none;color:var(--text-primary);transition:.3s}
  .related-card:hover{border-color:rgba(201,169,110,.2);transform:translateY(-2px)}
  .related-card img{width:160px;height:120px;object-fit:cover;flex-shrink:0}
  .related-info h4{font-family:var(--font-heading);margin-bottom:var(--space-xs)}
  .related-info span{color:var(--text-muted);font-size:.85rem}
  @media(max-width:768px){.process-grid{grid-template-columns:repeat(2,1fr)}.related-card{flex-direction:column}.related-card img{width:100%;height:160px}}
</style>
